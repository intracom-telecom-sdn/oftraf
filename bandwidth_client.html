<!DOCTYPE HTML>
<html>

<head>
  <script type="text/javascript">
    window.onload = function () {
      var units = Object.freeze({PACKETS: 0, BYTES: 1});


      var dps = []; // dataPoints
      var URL = "http://127.0.0.1:5008/get_of_counts";
      var countsType = "OF_in_counts";
      var packetsOrBytes = units.BYTES;
      var chart = new CanvasJS.Chart("chartContainer",{
        title :{
          text: "Live Bandwidth Bytes In (KB/s)"
        },
        data: [{
          type: "line",
          dataPoints: dps
        }]
      });

      var xVal = 0;
      var updateInterval = 500;
      var dataLength = 1000; // number of dataPoints visible at any point
      var diffYVal = 0;
      var prevYVal = 0;
      jQuery.ajax({
        type: "GET",
        url: URL,
        async:true,
        dataType : 'json',   //you may use jsonp for cross origin request
        success: function(data, status, jqXHR) {
          prevYVal = data[countsType][packetsOrBytes];
        },
        error: function(jqXHR, status) {
          console.log('ERROR initial request');
          prevYVal = 0;               
        }
      });
      var updateChart = function (url, key, pOrB) {
        // packetsOrBytes is 0 for packets and 1 for bytes
        // key is one of
        //    "OF_out_counts"
        //    "OF_in_counts"
        //    "OF13_OFPT_ECHO_REPLY"
        //    "OF13_OFPT_ECHO_REQUEST"
        //    "OF13_OFPT_FLOW_MOD"
        //    "OF13_OFPT_MULTIPART_REPLY"
        //    "OF13_OFPT_MULTIPART_REQUEST"
        //    "OF13_OFPT_PACKET_IN"
        //    "OF13_OFPT_PACKET_OUT"
        jQuery.ajax({
            type: "GET",
            url: url,
            async:true,
            dataType : 'json',   //you may use jsonp for cross origin request
            success: function(data, status, jqXHR) {
              yVal = data[key][pOrB];
              diffYVal = 1000 * ((yVal - prevYVal) >> 10) / updateInterval ;
              console.log(diffYVal);
              prevYVal = yVal;
            },
            error: function(jqXHR, status) {
              diffYVal = -1;               
            }
        });
       dps.push({
            x: xVal,
            y: diffYVal
        });
        xVal = xVal + updateInterval / 1000;

        if (dps.length > dataLength) {
            dps.shift();
        }

        chart.render();
      };

      // generates first set of dataPoints
      dps.push({ x: 0, y: 0});
      chart.render();

      // update chart after specified time.
      setInterval(function(){ updateChart(URL, countsType, packetsOrBytes) }, updateInterval);
    }
  </script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
</head>
<body>
  <div id="chartContainer" style="height: 300px; width:100%;"></div>
</body>
</html>
